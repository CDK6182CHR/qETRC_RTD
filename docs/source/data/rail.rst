基线数据
~~~~~~~~~

.. _rail_concepts:

基本概念
^^^^^^^^^

在本软件中，一条\ **基线**\ 或者\ **线路**\ 是指一段连续、无分支结构的铁路线路。

线路的最基本信息由其里程表给出。里程表是一组车站的有序序列，规定基线上每个站的站名、里程标和一些其他的相关数据（详见下节）。里程表内车站从先到后的方向称为\ **下行方向**\ ，反之称为\ **上行方向**\ 。

.. note::
    本软件中所称的下行、上行方向由上面的叙述规定，原则上与实际铁路线路的上下行方向无关。为了减少不必要的误会，强烈建议设置的上下行方向与实际保持一致。

本软件允许设置\ **单向站**\ ，即仅上行或下行单边经过、另一边不经过的车站，也允许设置上下行不一致的里程。但基线的第一个站和最后一个站必须设置为非单向站，即上下行都通过的站。

.. note::
    逻辑上，本软件中所有线路皆为双线，暂不支持设置单双线。对于单线来说，只需要把上下行的相关数据设置成相同即可。

.. note::
    本软件允许一个运行图文件中有多条基线。除此之外，基线部分逻辑和pyETRC完全一致。


基线增删
^^^^^^^^^

qETRC中允许一个运行图文件具有多条基线。有以下方式可以为运行图文件添加新的空白基线：

- 在运行图资源管理器中， :guilabel:`基线数据` 右键菜单中选择 :guilabel:`添加空白线路` 
- 在 :guilabel:`线路` 工具栏页面中，选择 :guilabel:`新建线路` 

新建线路后，将自动打开该线路的里程表编辑页面（参见下节）。

除了以上新建空白基线的方式外，还可以通过导入外部数据，或者从线路数据库中导入线路的方式，增加既有的基线。参见 :doc:`数据交互 </interchange/index>` :doc:`线路数据库 </railnet/index>` 。

.. hint::
    基线和运行图页面是两种不同的数据元素；一个运行图页面可以包含一条或多条基线，一条基线也可以同时属于一个、多个或不属于任何运行图页面。新建空白基线后，还需要新建运行图页面，或者将新线路加入到既有运行图页面，才能显示运行图。参见 :ref:`sec_page` 。

可以通过以下方法删除一条基线：

- 在运行图资源管理器中的对应基线上使用右键菜单中的 :guilabel:`删除基线` 
- 在 :guilabel:`线路工具` 上下文工具栏页面中，选择 :guilabel:`删除基线`

删除基线时，会同时将基线从所在的运行图页面中移除；如果被移除后，运行图页面不包含任何线路，则该运行图页面也被删除。如果撤销，则运行图页面一并恢复。

.. warning::
    如果删除运行图文件中的全部基线，可能导致非预期的行为，虽然程序并不禁止这个操作。强烈不建议这样做。


里程表编辑
^^^^^^^^^^^

线路里程表编辑器可以从以下方式打开：

- 在运行图资源管理器中，双击基线名称，或右键菜单中选择 :guilabel:`编辑基线` 
- 在 :guilabel:`线路` 工具栏页面中，找到 :guilabel:`线路编辑` 按钮，选择相应的线路。
- 在当前线路的 :guilabel:`线路工具` 上下文页面中，点击 :guilabel:`基线编辑` 按钮。

下图所示为里程表编辑的页面。所有打开的基线编辑窗口，都在 :guilabel:`线路` 工具栏页面下 :guilabel:`线路编辑` 的下拉菜单中有对应选项，如果关闭了窗口，可以从这里再次打开。

.. figure:: /_static/img/data/railstation.png
    :alt: 基线编辑

其中涉及的主要数据字段说明如下：

- 站名。本线的站名必须非空且唯一。
- 里程。是指自首站开始的下行线延长公里数，可精确到三位小数。单位为公里。原则上首站里程应为0，如果不是0，则点击 :guilabel:`确定` 时，会提示是否修改为0。

.. tip::
    通过将首站的里程修改为非零，利用提交时的自动修改里程，可以实现本线里程的批量增减。

- 对里程。是指自首站开始的上行线延长公里数，可选填，精确至三位小数。如果不填，或者填入的不是数字，则按无数据处理。当需要计算上行线里程的区间缺失对里程数据时，则使用“里程”数据（即下行线里程）计算。对于上下行里程一致的线路，或者单线，直接不填即可。
- 显示。如果不勾选，则运行图中不会显示该站的水平线；如果按标尺排图，则“排图标尺”栏该站上下区间被打通为一个区间。
- 单向站。决定某车站是否为单向通过站，可以设置为 ``上下行`` ``下行`` ``上行`` ``不通过`` 四者之一。如果设置为 ``不通过`` ，则该车站不会被画在运行图上，相当于不存在。
- 办客、办货。设置该车站是否办理客运业务和货运业务。默认情况下，客车在办客车站营业，货车在非办客车站营业。

| TODO: 标尺、天窗；标尺排图（放到运行图格式那里）；


.. _sec_railint:

标尺、天窗
~~~~~~~~~~~

区间数据
^^^^^^^^^

标尺和天窗有时也可统称为\ **区间数据**\ ，它们都是附属于基线中每两个站之间所形成的\ **区间**\ （而非是车站本身）的数据。由于qETRC支持单向站（参见 :ref:`rail_concepts`\ ），区间与车站之间的关系并非简单的一一对应关系。举例来说，设有车站序列A,B,C，其中A,C为双向站，B为下行单向站，则存在下行区间A->B, B->C，上行区间C->A，但不存在下行区间A->C，也不存在上行区间C->B。


.. _sec_page:

运行图页面
~~~~~~~~~~


