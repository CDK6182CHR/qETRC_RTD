
列车数据
---------

.. tip::
    关于列车数据的技术实现，可以参见专栏文章：

列车数据通常是本系统中最重要、最复杂、体量最大的一类数据。一个运行图文件包含一组列车数据，每趟列车包含车次名、时刻表以及一些显示设定等数据。本文档（及软件）中，在不致产生歧义的情况下，\ **列车**\ 与\ **车次**\ 两个名词常常通用。

列车与运行线
~~~~~~~~~~~~~

一趟列车有一套\ **时刻表**\ (timetable)，\ **依次**\ 给出列车在各个车站的到达、出发时刻。在本系统的具体实现中，时刻表不要求是完整的，也不要求是连续的，也即时刻表不必涵盖始发站到终到站的每一个站，具有其中一段、或一部分非连续的车站数据也可以绘制运行图，但在具体问题处理上可能有一些更严格的限制。

.. important::
    强调时刻表顺序的重要性。由于时刻具有（24小时的）周期性，本软件会认为时刻表从前到后的时间是严格单调不减的，如果出现后一站时刻比前一站时刻“早”的情况，会将后一站时刻判定为第二天的时刻。因此时刻表顺序错误通常会造成非预期的结果。

\ **运行线**\ 是运行图上一段表示列车的线条（包括可能具有的开始和结束标签）。在本系统中，运行线仅描述\ **一趟列车在同一条线路上的一段单向、连续的运行情况**\ 。一趟列车可以具有多段不同方向、属于不同线路的运行线。

.. important::
    以上表述是本系统列车运行线逻辑的核心概括，是理解运行线及相关算法的关键，特别是涉及列车分段、折返运行时。

鉴于以上表述在概念上的重要性，这里进一步做些解读。(1) 运行线仅是同一线路上的，不在同一条线路上的区段一定不属于同一运行线；(2) 运行线必然是单向（指在线路中的上行或者下行）的，如果列车运行发生折返，则折返前后必分属两段运行线；(3) 运行线是连续的，如果列车在两站之间经由其他线路而非本线运行，则前后应当为两条运行线；(4) 列车在某线路上的运行里程就是其在该线路上每一条运行线对应里程之和，而不是列车在该线路上第一站和最后一站之间的距离。这对于正确处理分段和折返运行的情况，是关键的。

下图给出了运行线分段的例子。40001在成都-成都西和红牌楼-石羊线路所分为两段运行线；而40103/4次在成都-红牌楼区间下行运行，在红牌楼-成都西区间折返为上行运行，故也是两段运行线。

.. figure:: /_static/img/data/item.png
    :alt: 运行线分段

与pyETRC不一样的是，qETRC目前仅支持自动运行线管理，而不支持手动配置运行线信息。工具栏上下文页面 :guilabel:`列车审阅` | :guilabel:`运行线一览` 功能可以查看当前所选列车的所有运行线信息，如下图所示

.. figure:: /_static/img/data/trainline-overview.png
    :alt: 运行线一览


