
列车运行分析
~~~~~~~~~~~~~

列车信息
^^^^^^^^^

:起始版本: V1.0.0
:最新修订: V1.7.3
:pyETRC对应功能: 列车信息
:快捷键: ``Ctrl`` + ``Q``
:工具栏: ``列车(3)`` | ``速览信息``

此功能又称“速览信息”，是以一个停靠面板的形式呈现的，默认情况下放在界面右侧停靠。当在运行图中选取车次时，此面板的信息会同步为新选择的车次的信息。此面板显示列车的一些基本信息、运行统计信息等，只能查看，不能修改。方便起见，提供了一些转到其他功能（例如交路编辑面板或列车时刻表）的入口。

.. figure:: /_static/img/analysis/train-info.png
    :alt: 速览信息-V1.7.2

上图所示为速览信息窗口。篇幅所限，只截图了一部分。其中，大部分的条目应具有显然的含义，这里不赘述。对于一些不易理解或可能存在误解可能的，这里做必要的说明。

- ``旅客列车`` 显示当前车次是否属于旅客列车。旅客列车性质可以自动推定（根据列车种类），也可以手动指定。当使用自动推定时，将显示 ``自动`` ，并在后加括号中，注明推定结果。
- ``总/铺画站数`` 包含以斜杠分隔的两个数据。前者表示总站数，即时刻表中的车站数；后者表示铺画站数，即时刻表中、在本运行图中线路的车站上有对应的站数，即实际铺画到运行图的站数。
- ``运行线情况`` 统计了该车次所拥有的运行线及其涉及的线路数量。运行线的中断、折返，以及在不同线路上的运行线，都是不同的运行线，分别计数。
- ``总历时`` 是当前车次自时刻表第一站到达时刻起，至时刻表最后一站出发时刻止的总时长。 ``总停站时间`` 是上述时长中，停站时间的总和； ``总运行时间`` 是总历时去掉停站时间的纯运行时间。这几项数据总是可以从时刻表直接得出，与是否有线路数据、是否铺画到运行图无关。上述数据皆包含首站、末站的停车时间（如果存在；自V1.7.3版本起）。
- ``总里程`` 是指该列车自首站到末站的总里程。注意，由于首站和末站并不总是铺画到了运行图上，因此其位置（里程）信息及其关系可能是未知的，因此这项数据并不总是可得的。只有当首站和末站皆铺画在运行图上，且首站到末站之间，各段运行线间能够找到一条完全铺画在运行图上的路径时，总里程才是可知的。关于这部分的详细逻辑及其实现，可以参见知乎专栏文章： https://zhuanlan.zhihu.com/p/609652440。
- ``总旅行速度`` 是总里程除以总历时。 ``总技术速度`` 是总里程除以总运行时间。显然，这两者的计算都依赖于可用的总里程数据。当总里程不可知时，这两者自然不可知。
- ``铺画里程`` 是本运行图文件中，该列车的 **所有运行线** 的里程之和。在一些情况下，多条线路可能包含实际上是重复的区间；在这种情况下，铺画里程并非实际有意义的里程，甚至有可能比总里程数值更大。 ``铺画总时间`` 是相应的所有运行线的运行时间总和。由于前面提到的原因，铺画总时间有可能大于总历时。 ``铺画旅行速度`` 和 ``铺画技术速度`` 是与铺画里程、铺画总时间相应的旅行速度和技术速度。
- ``前序 (连线)`` 给出有交路信息的列车在其所属交路中的前序车次名，并在括号中注明是否连线。注意，此处的连线是指运行图铺画过程中是否 **实际** 可能有连线，可能与用户设置不同。例如，若交路中设置前序车次连线，但前序车次终到站与本车次始发站并非同一站，则这个连线的设置是无效的，实际画图时并不会连线，此处显示否。 ``后续 (连线)`` 与此类似，对应于后续车次。

列车时刻表
^^^^^^^^^^^

:起始版本: V1.0.0
:最新修订: 
:pyETRC对应功能: 车次时刻表、交互式时刻表
:快捷键: ``Ctrl`` + ``I``
:工具栏: ``列车(3)`` | ``速览时刻``

此功能又称“速览时刻”，提供一种双行格式的时刻表。在时刻表中，每个车站占两行，其中第一行为到达时刻、停车时长（或始发/终到标记），第二行为出发时刻、股道信息。默认情况下，以停靠面板形式，放在界面右侧停靠。

.. figure:: /_static/img/analysis/train-timetable.png
    :alt: 速览时刻-V1.7.2

界面首行显示车次及其始发终到站，只能查看，不能编辑。其下有两个选项。若勾选 ``仅停车/营业站`` ，则只有存在停车（包含始发或终到）或营业的车站被显示，其他车站隐藏；若勾选 ``编辑`` ，则可以在点击时刻表单元格后编辑时刻，对时刻的调整立即生效并重新铺画当前车次的运行线。本停靠面板所显示的列车随当前选择的列车变化而同步变化。
利用右键菜单，可以将车站定位到运行图上（如果有铺画点）。

表内文字颜色代表下列含义：

- 灰色：该车站没有铺画点，没有铺画在运行图上。即当前运行图中，没有运行线包含该车站。以下其他颜色，皆是在有铺画点的条件下进一步细化。
- 红色：该车站营业。通常只有在停车的站或始发终到站营业才有意义。关于营业站的设置，参见 :ref:`列车时刻表编辑<sec_timetable_basic>` 。
- 蓝色：该车站有停车（到达时刻和出发时刻不同）或为始发/终到站，但不营业。
- 黑色：其他情况（该车站为通过车站且有铺画点）。

表内的显示内容按如下规则（按照顺序依次匹配）：

- 对于有停点的车站（到达、出发时刻不相同）， ``时刻`` 列的第一、二行分别显示到达、出发时刻， ``停时股道`` 列第一行显示停车时长。
- 对于始发站， ``时刻`` 列第一行留空，第二行显示出发时刻。 ``停时股道`` 列第一行显示 ``始`` 标记。
- 对于终到站， ``时刻`` 列第一行为到达时刻，第二行显示 ``--`` ， ``停时股道`` 列第一行显示 ``终`` 标记。
- 对于通过站（不是以上三种情况的）， ``时刻`` 列第一行显示 ``...`` ，第二行显示通过时刻， ``停时股道`` 列第一行留空。


.. _sec_train_event:

列车事件表
^^^^^^^^^^^

:起始版本: V1.0.0
:最新修订: 
:pyETRC对应功能: 车次事件表
:ETRC对应功能: 车次切片
:工具栏: ``列车审阅 (6)`` | ``事件表``
:右键菜单: 运行图窗口右键 | ``事件表``

.. tip::
    关于此功能的详细逻辑、算法及其实现，可参见专栏文章：https://zhuanlan.zhihu.com/p/402664135

此功能展示所选列车运行过程中的一系列事件的时刻、位置等信息。此处所指的列车事件包括下列几类：

- 到达、出发；终到、始发。由列车时刻表直接给出。
- 通过。分为图定和推定两种。时刻表中到达时刻与出发时刻相同，且不是始发或终到的车站，是图定通过。不在时刻表中，但运行线跨过了的车站（线路上的车站），系统会根据前后的图定车站时刻，线性插值，推算通过是超额。
- 越行、让行。同方向（上行或下行）的两列车之间运行线相交，一方超过另一方运行，则前者越行后者，后者让行前者。通常越行/让行事件应在站内发生，若在区间发生，通常时刻表存在问题。
- 交会。不同方向（上下行）的两列车运行线相交，无论站内站外，皆构成交会事件。

qETRC中，列车事件表的计算是基于 **运行线** 完成的。各个事件皆有发生的地点（线路上的某个车站，或某个区间，以及里程标）。这就意味着，时刻表上没有铺画运行线的车站或者区间不会反映在事件表中。不同线路上发生的事件分别列出，其先后顺序不做保证。

.. figure:: /_static/img/analysis/train-events.png
    :alt: 列车事件表-V1.7.2

上图所示为列车事件表的界面。每个窗口对应于单一的列车（显示在标题栏上）。 ``客体`` 一列显示的是越行、让行、交会事件发生的对象（另一列车车次）；对于到达、出发、通过等事件，该列留空。其余各列具有显然的含义。
点击 ``ETRC风格`` 可以生成类似ETRC车次切片格式的文本，反映的信息与表格相同，例如：

.. code::

    G7568在宁杭高速线(双线)的事件表:
    1. 256.000 km.  11:50:00  [杭州东] 站 到达
    2. 256.000 km.  11:52:00  [杭州东] 站 发车
    3. 254.452 km.  11:52:25  [杭州东 - 杭州东所*] 区间 会 G343
    4. 247.000 km.  11:54:28  [杭州东所*] 站 通过 (推算)




运行线一览
^^^^^^^^^^^

时刻诊断
^^^^^^^^^

列车运行统计
^^^^^^^^^^^^^

列车对照分析
~~~~~~~~~~~~~

标尺对照
^^^^^^^^^

车次对照
^^^^^^^^^

运行图对比
^^^^^^^^^^^

